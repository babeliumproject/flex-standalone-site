<?php

function forwards(){
	global $DB;
	try{
		$DB->_startTransaction();
	
		//Add two columns
		$sql =	"ALTER TABLE `subtitle`
		ADD COLUMN `serialized_subtitles` longtext NOT NULL,
		ADD COLUMN `subtitle_count` int(10) unsigned NOT NULL";
		$DB->_update($sql);
	
		//Data migration
		$sql = "SELECT sl.*, er.character_name AS role_name
		FROM subtitle_line sl INNER JOIN exercise_role er ON sl.fk_exercise_role_id=er.id WHERE TRUE
		ORDER BY sl.fk_subtitle_id, sl.show_time";
	
		$results = $DB->_multipleSelect($sql);
		$subtitles = array();
		$cuepoints = array();
		foreach ($results as $r){
			if(!isset($subtitles[$r->fk_subtitle_id])){
				$subtitles[$r->fk_subtitle_id] = array();
			}
			$subline = array();
			$subline['start_time'] = $r->show_time * 1000; //time representation in ms
			$subline['end_time'] = $r->hide_time * 1000; //time representation in ms
			$subline['text'] = trim($r->text);
			//For now we won't allow more than one voice per subtitle line
			if($r->role_name)
				$subline['meta']['voice']  = $r->role_name;
	
			$subtitles[$r->fk_subtitle_id][] = $subline;
		}
	
		foreach ($subtitles as $subtitle_id => $subtitle_data){
			$subtitle_count = count($subtitle_data);
			$serialized_subtitles = custom_json_encode($subtitle_data);
			$cb64_subtitles = packblob($serialized_subtitles);
	
			$sql = "UPDATE subtitle SET serialized_subtitles='%s', subtitle_count=%d WHERE id=%d";
			$affected_rows = $DB->_update($sql, $cb64_subtitles, $subtitle_count, $subtitle_id);
		}
		
		$drop1 = "DROP TABLE subtitle_line";
		$DB->_update($drop1);
		$drop2 = "DROP TABLE exercise_role";
		$DB->_update($drop2);
		
		$DB->_endTransaction();
	
	} catch (Exception $e){
		$DB->_failedTransaction();
		throw $e;
	}
}

function backwards(){
	global $DB;
	try{
		//Recover the `subtitle_line` and the `exercise_role` tables
		$sql1 = "CREATE TABLE `exercise_role` (
				`id` int(10) unsigned NOT NULL AUTO_INCREMENT,
				`fk_exercise_id` int(10) unsigned NOT NULL,
				`fk_user_id` int(10) unsigned DEFAULT NULL,
				`character_name` varchar(45) NOT NULL,
				PRIMARY KEY (`id`),
				KEY `FK_exercise_characters_1` (`fk_exercise_id`),
				KEY `FK_exercise_characters_2` (`fk_user_id`),
				CONSTRAINT `FK_exercise_characters_1` FOREIGN KEY (`fk_exercise_id`) REFERENCES `exercise` (`id`) ON DELETE CASCADE ON UPDATE CASCADE,
				CONSTRAINT `FK_exercise_characters_2` FOREIGN KEY (`fk_user_id`) REFERENCES `user` (`ID`) ON DELETE SET NULL ON UPDATE SET NULL
				) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8";
		$DB->_update($sql1);
		
		$sql2 = "CREATE TABLE `subtitle_line` (
				`id` int(10) unsigned NOT NULL AUTO_INCREMENT,
				`fk_subtitle_id` int(10) unsigned NOT NULL,
				`show_time` float unsigned NOT NULL,
				`hide_time` float unsigned NOT NULL,
				`text` varchar(255) NOT NULL,
				`fk_exercise_role_id` int(10) unsigned NOT NULL,
				PRIMARY KEY (`id`),
				KEY `FK_subtitle_line_1` (`fk_subtitle_id`),
				KEY `FK_subtitle_line_2` (`fk_exercise_role_id`),
				CONSTRAINT `FK_subtitle_line_1` FOREIGN KEY (`fk_subtitle_id`) REFERENCES `subtitle` (`id`) ON DELETE CASCADE ON UPDATE CASCADE,
				CONSTRAINT `FK_subtitle_line_2` FOREIGN KEY (`fk_exercise_role_id`) REFERENCES `exercise_role` (`id`) ON DELETE CASCADE ON UPDATE CASCADE
				) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8";
		$DB->_update($sql2);
		
		//Populate with the content those tables had before
		$sql = "SELECT * FROM subtitle WHERE id>0";
		$results = $DB->_multipleSelect($sql);
		
		foreach($results as $s){
			$plaindata = unpackblob($s->serialized_subtitles);
			$subtitleLines = Zend_Json::decode($plaindata);
			
			foreach($subtitleLines as $line){	
				//Insert the new exercise_roles
				$er_sql = "INSERT INTO exercise_role (fk_exercise_id, fk_user_id, character_name) VALUES ";
				$params = array();
				$distinctRoles = array();
				foreach($subtitleLines as $line){
					if(count($distinctRoles)==0){
						$distinctRoles[] = $line->meta->voice;
						$er_sql .= " ('%d', '%d', '%s' ),";
						array_push($params, $s->fk_exercise_id, $s->fk_user_id, $line->meta->voice );
					}
					else if(!in_array($line->meta->voice,$distinctRoles)){
						$distinctRoles[] = $line->meta->voice;
						$er_sql .= " ('%d', '%d', '%s' ),";
						array_push($params, $s->fk_exercise_id, $s->fk_user_id, $line->meta->voice);
					}
				}
				unset($line);
				$er_sql = substr($er_sql,0,-1);
				// put sql query and all params in one array
				$merge = array_merge((array)$er_sql, $params);
				$lastRoleId = $DB->_insert($merge);
				if(!$lastRoleId){
					$DB->_failedTransaction();
					throw new Exception("Subtitle save failed");
				}
				
				//Insert the new subtitle_lines
				$params = array();
				
				$sqluroles = "SELECT MAX(id) as id, fk_exercise_id as exerciseId, character_name as characterName
							  FROM exercise_role WHERE (fk_exercise_id = %d AND fk_user_id= %d)
							  GROUP BY exercise_role.character_name ";
				
				$userRoles = $DB->_multipleSelect ( $sql, $s->fk_exercise_id, $s->fk_user_id );
				
				$sl_sql = "INSERT INTO subtitle_line (fk_subtitle_id, show_time, hide_time, text, fk_exercise_role_id) VALUES ";
				foreach($subtitleLines as $line){
					foreach($userRoles as $role){
						if ($role->characterName == $line->meta->voice){
							$line->exerciseRoleId = $role->id;
							$sl_sql .= " ('%d', '%s', '%s', '%s', '%d' ),";
							array_push($params, $subtitleId, round($line->start_time / 1000, 2), round($line->end_time / 1000, 2), $line->text, $line->exerciseRoleId);
							break;
						}
					}
					unset($role);
				}
				unset($line);
				$sl_sql = substr($sl_sql,0,-1);
				// put sql query and all params in one array
				$merge = array_merge((array)$sl_sql, $params);
				$lastSubtitleLineId = $DB->_insert($merge);
				if(!$lastSubtitleLineId){
					$DB->_failedTransaction();
					throw new Exception("Subtitle save failed");
				}
			}
		}
		
		$sql =	"ALTER TABLE `subtitle` DROP COLUMN `serialized_subtitles`, DROP COLUMN `subtitle_count`";
		$DB->_update($sql);
		
	} catch(Exception $e){
		throw $e;
	}
}

//Helper functions
function packblob($data){
	if(($compressed = gzcompress($data)) !== FALSE){ //Default compression level is 6 [1..9]
		if(($encoded = base64_encode($compressed)) !== FALSE){
			return $encoded;
		}
	}
	return $data;
}

function unpackblob($data){
	if(($decoded = base64_decode($data)) !== FALSE){
		if(($plaindata = gzuncompress($decoded)) !== FALSE){
			return $plaindata;
		}
	}
	return $data;
}

$models = '{"assignment":{"id":{"type":{"name":"int","size":"10","unsigned":true},"empty":"NO","key":"PRI","default":null,"extra":"auto_increment"},"fk_course_id":{"type":{"name":"int","size":"10","unsigned":true},"empty":"NO","key":"MUL","default":null,"extra":"","constraint":{"referenced_table":"course","referenced_column":"id","update_rule":"NO ACTION","delete_rule":"NO ACTION"}},"name":{"type":{"name":"varchar","size":"255"},"empty":"NO","key":"","default":null,"extra":""},"description":{"type":{"name":"longtext"},"empty":"NO","key":"","default":null,"extra":""},"duedate":{"type":{"name":"bigint","size":"10","unsigned":true},"empty":"NO","key":"","default":"0","extra":""},"allowsubmissionsfromdate":{"type":{"name":"bigint","size":"10","unsigned":true},"empty":"NO","key":"","default":"0","extra":""},"grade":{"type":{"name":"varchar","size":"45"},"empty":"YES","key":"","default":null,"extra":""},"timemodified":{"type":{"name":"bigint","size":"10","unsigned":true},"empty":"NO","key":"","default":"0","extra":""},"teamsubmission":{"type":{"name":"tinyint","size":"1"},"empty":"NO","key":"","default":"0","extra":""},"requireallteammemberssubmit":{"type":{"name":"tinyint","size":"1"},"empty":"NO","key":"","default":"0","extra":""},"maxattempts":{"type":{"name":"int","size":"10","unsigned":true},"empty":"NO","key":"","default":"0","extra":""},"Meta":[{"type":"primary","columns":"id"},{"type":"index","columns":"fk_course_id"}]},"assignment_submission":{"id":{"type":{"name":"int","size":"10","unsigned":true},"empty":"NO","key":"PRI","default":null,"extra":"auto_increment"},"fk_assignment_id":{"type":{"name":"int","size":"10","unsigned":true},"empty":"NO","key":"MUL","default":null,"extra":"","constraint":{"referenced_table":"assignment","referenced_column":"id","update_rule":"NO ACTION","delete_rule":"NO ACTION"}},"fk_user_id":{"type":{"name":"int","size":"10","unsigned":true},"empty":"NO","key":"MUL","default":null,"extra":"","constraint":{"referenced_table":"user","referenced_column":"id","update_rule":"NO ACTION","delete_rule":"NO ACTION"}},"timecreated":{"type":{"name":"bigint","size":"10"},"empty":"NO","key":"","default":"0","extra":""},"timemodified":{"type":{"name":"bigint","size":"10"},"empty":"NO","key":"","default":"0","extra":""},"status":{"type":{"name":"varchar","size":"255"},"empty":"NO","key":"","default":"","extra":""},"fk_group_id":{"type":{"name":"int","size":"10","unsigned":true},"empty":"YES","key":"MUL","default":null,"extra":"","constraint":{"referenced_table":"course_groups","referenced_column":"id","update_rule":"NO ACTION","delete_rule":"NO ACTION"}},"attempnumber":{"type":{"name":"int","size":"10","unsigned":true},"empty":"YES","key":"","default":"0","extra":""},"Meta":[{"type":"primary","columns":"id"},{"type":"index","columns":"fk_assignment_id"},{"type":"index","columns":"fk_user_id"},{"type":"index","columns":"fk_group_id"}]},"course":{"id":{"type":{"name":"int","size":"11","unsigned":true},"empty":"NO","key":"PRI","default":null,"extra":"auto_increment"},"category":{"type":{"name":"int","size":"11"},"empty":"NO","key":"","default":"0","extra":""},"fullname":{"type":{"name":"varchar","size":"255"},"empty":"NO","key":"","default":"","extra":""},"fk_serviceconsumer_id":{"type":{"name":"int","size":"10","unsigned":true},"empty":"NO","key":"MUL","default":null,"extra":"","constraint":{"referenced_table":"serviceconsumer","referenced_column":"id","update_rule":"NO ACTION","delete_rule":"NO ACTION"}},"idnumber":{"type":{"name":"int","size":"11"},"empty":"NO","key":"","default":"0","extra":""},"shortname":{"type":{"name":"varchar","size":"255"},"empty":"NO","key":"","default":"","extra":""},"summary":{"type":{"name":"longtext"},"empty":"YES","key":"","default":null,"extra":""},"format":{"type":{"name":"varchar","size":"21"},"empty":"NO","key":"","default":"topics","extra":""},"startdate":{"type":{"name":"bigint","size":"10"},"empty":"NO","key":"","default":"0","extra":""},"visible":{"type":{"name":"tinyint","size":"1"},"empty":"NO","key":"","default":"1","extra":""},"language":{"type":{"name":"varchar","size":"45"},"empty":"NO","key":"","default":"","extra":""},"timecreated":{"type":{"name":"bigint","size":"10"},"empty":"NO","key":"","default":"0","extra":""},"timemodified":{"type":{"name":"bigint","size":"10"},"empty":"NO","key":"","default":"0","extra":""},"Meta":[{"type":"primary","columns":"id"},{"type":"index","columns":"fk_serviceconsumer_id"}]},"course_groups":{"id":{"type":{"name":"int","size":"10","unsigned":true},"empty":"NO","key":"PRI","default":null,"extra":"auto_increment"},"fk_course_id":{"type":{"name":"int","size":"10","unsigned":true},"empty":"NO","key":"MUL","default":null,"extra":"","constraint":{"referenced_table":"course","referenced_column":"id","update_rule":"NO ACTION","delete_rule":"NO ACTION"}},"name":{"type":{"name":"varchar","size":"255"},"empty":"NO","key":"","default":"","extra":""},"description":{"type":{"name":"longtext"},"empty":"YES","key":"","default":null,"extra":""},"timecreated":{"type":{"name":"bigint","size":"10"},"empty":"NO","key":"","default":"0","extra":""},"timemodified":{"type":{"name":"bigint","size":"10"},"empty":"NO","key":"","default":"0","extra":""},"Meta":[{"type":"primary","columns":"id"},{"type":"index","columns":"fk_course_id"}]},"credithistory":{"id":{"type":{"name":"int","size":"10","unsigned":true},"empty":"NO","key":"PRI","default":null,"extra":"auto_increment"},"fk_user_id":{"type":{"name":"int","size":"10","unsigned":true},"empty":"NO","key":"MUL","default":null,"extra":"","constraint":{"referenced_table":"user","referenced_column":"id","update_rule":"CASCADE","delete_rule":"CASCADE"}},"fk_exercise_id":{"type":{"name":"int","size":"10","unsigned":true},"empty":"NO","key":"MUL","default":null,"extra":"","constraint":{"referenced_table":"exercise","referenced_column":"id","update_rule":"CASCADE","delete_rule":"CASCADE"}},"fk_response_id":{"type":{"name":"int","size":"10","unsigned":true},"empty":"YES","key":"MUL","default":null,"extra":"","constraint":{"referenced_table":"response","referenced_column":"id","update_rule":"CASCADE","delete_rule":"CASCADE"}},"fk_eval_id":{"type":{"name":"int","size":"10","unsigned":true},"empty":"YES","key":"","default":null,"extra":""},"changeDate":{"type":{"name":"datetime"},"empty":"NO","key":"","default":null,"extra":""},"changeType":{"type":{"name":"varchar","size":"45"},"empty":"NO","key":"","default":null,"extra":""},"changeAmount":{"type":{"name":"int","size":"11"},"empty":"NO","key":"","default":"0","extra":""},"Meta":[{"type":"primary","columns":"id"},{"type":"index","columns":"fk_user_id"},{"type":"index","columns":"fk_response_id"},{"type":"index","columns":"fk_exercise_id"}]},"evaluation":{"id":{"type":{"name":"int","size":"10","unsigned":true},"empty":"NO","key":"PRI","default":null,"extra":"auto_increment"},"fk_response_id":{"type":{"name":"int","size":"10","unsigned":true},"empty":"NO","key":"MUL","default":null,"extra":"","constraint":{"referenced_table":"response","referenced_column":"id","update_rule":"CASCADE","delete_rule":"CASCADE"}},"fk_user_id":{"type":{"name":"int","size":"10","unsigned":true},"empty":"NO","key":"MUL","default":null,"extra":"","constraint":{"referenced_table":"user","referenced_column":"ID","update_rule":"NO ACTION","delete_rule":"NO ACTION"}},"score_overall":{"type":{"name":"tinyint","size":"4"},"empty":"YES","key":"","default":"0","extra":""},"comment":{"type":{"name":"text"},"empty":"YES","key":"","default":null,"extra":""},"adding_date":{"type":{"name":"timestamp"},"empty":"YES","key":"","default":"CURRENT_TIMESTAMP","extra":""},"score_intonation":{"type":{"name":"tinyint","size":"3","unsigned":true},"empty":"YES","key":"","default":"0","extra":""},"score_fluency":{"type":{"name":"tinyint","size":"3","unsigned":true},"empty":"YES","key":"","default":"0","extra":""},"score_rhythm":{"type":{"name":"tinyint","size":"3","unsigned":true},"empty":"YES","key":"","default":"0","extra":""},"score_spontaneity":{"type":{"name":"tinyint","size":"3","unsigned":true},"empty":"YES","key":"","default":"0","extra":""},"Meta":[{"type":"primary","columns":"id"},{"type":"index","columns":"fk_response_id"},{"type":"index","columns":"fk_user_id"}]},"evaluation_video":{"id":{"type":{"name":"int","size":"10","unsigned":true},"empty":"NO","key":"PRI","default":null,"extra":"auto_increment"},"fk_evaluation_id":{"type":{"name":"int","size":"10","unsigned":true},"empty":"NO","key":"MUL","default":null,"extra":"","constraint":{"referenced_table":"evaluation","referenced_column":"id","update_rule":"CASCADE","delete_rule":"CASCADE"}},"video_identifier":{"type":{"name":"varchar","size":"100"},"empty":"NO","key":"","default":null,"extra":""},"source":{"type":{"name":"enum"},"empty":"NO","key":"","default":null,"extra":""},"thumbnail_uri":{"type":{"name":"varchar","size":"200"},"empty":"NO","key":"","default":"nothumb.png","extra":""},"duration":{"type":{"name":"int","size":"10","unsigned":true},"empty":"NO","key":"","default":null,"extra":""},"Meta":[{"type":"primary","columns":"id"},{"type":"index","columns":"fk_evaluation_id"}]},"exercise":{"id":{"type":{"name":"int","size":"10","unsigned":true},"empty":"NO","key":"PRI","default":null,"extra":"auto_increment"},"name":{"type":{"name":"varchar","size":"255"},"empty":"NO","key":"","default":null,"extra":""},"description":{"type":{"name":"text"},"empty":"NO","key":"","default":null,"extra":""},"source":{"type":{"name":"enum"},"empty":"NO","key":"","default":null,"extra":""},"language":{"type":{"name":"varchar","size":"45"},"empty":"NO","key":"","default":null,"extra":""},"fk_user_id":{"type":{"name":"int","size":"10","unsigned":true},"empty":"NO","key":"MUL","default":null,"extra":"","constraint":{"referenced_table":"user","referenced_column":"ID","update_rule":"NO ACTION","delete_rule":"NO ACTION"}},"tags":{"type":{"name":"varchar","size":"100"},"empty":"NO","key":"","default":null,"extra":""},"title":{"type":{"name":"varchar","size":"80"},"empty":"NO","key":"","default":null,"extra":""},"thumbnail_uri":{"type":{"name":"varchar","size":"200"},"empty":"NO","key":"","default":"nothumb.png","extra":""},"adding_date":{"type":{"name":"datetime"},"empty":"NO","key":"","default":null,"extra":""},"duration":{"type":{"name":"int","size":"10","unsigned":true},"empty":"NO","key":"","default":null,"extra":""},"status":{"type":{"name":"enum"},"empty":"NO","key":"","default":"Unprocessed","extra":""},"filehash":{"type":{"name":"varchar","size":"32"},"empty":"NO","key":"","default":"none","extra":""},"fk_transcription_id":{"type":{"name":"int","size":"10","unsigned":true},"empty":"YES","key":"MUL","default":null,"extra":"","constraint":{"referenced_table":"transcription","referenced_column":"id","update_rule":"RESTRICT","delete_rule":"SET NULL"}},"license":{"type":{"name":"varchar","size":"60"},"empty":"NO","key":"","default":"cc-by","extra":""},"reference":{"type":{"name":"text"},"empty":"NO","key":"","default":null,"extra":""},"Meta":[{"type":"primary","columns":"id"},{"type":"index","columns":"fk_user_id"},{"type":"index","columns":"fk_transcription_id"}]},"exercise_comment":{"id":{"type":{"name":"int","size":"10","unsigned":true},"empty":"NO","key":"PRI","default":null,"extra":"auto_increment"},"fk_exercise_id":{"type":{"name":"int","size":"10","unsigned":true},"empty":"NO","key":"MUL","default":null,"extra":"","constraint":{"referenced_table":"exercise","referenced_column":"id","update_rule":"CASCADE","delete_rule":"CASCADE"}},"fk_user_id":{"type":{"name":"int","size":"10","unsigned":true},"empty":"NO","key":"MUL","default":null,"extra":"","constraint":{"referenced_table":"user","referenced_column":"ID","update_rule":"NO ACTION","delete_rule":"NO ACTION"}},"comment":{"type":{"name":"text"},"empty":"NO","key":"","default":null,"extra":""},"comment_date":{"type":{"name":"datetime"},"empty":"NO","key":"","default":null,"extra":""},"Meta":[{"type":"primary","columns":"id"},{"type":"index","columns":"fk_exercise_id"},{"type":"index","columns":"fk_user_id"}]},"exercise_descriptor":{"id":{"type":{"name":"int","size":"10","unsigned":true},"empty":"NO","key":"PRI","default":null,"extra":"auto_increment"},"level":{"type":{"name":"enum"},"empty":"NO","key":"MUL","default":null,"extra":""},"type":{"type":{"name":"enum"},"empty":"NO","key":"","default":null,"extra":""},"number":{"type":{"name":"int","size":"10","unsigned":true},"empty":"NO","key":"","default":null,"extra":""},"Meta":[{"type":"primary","columns":"id"},{"type":"index","columns":"level,type,number"}]},"exercise_descriptor_i18n":{"fk_exercise_descriptor_id":{"type":{"name":"int","size":"10","unsigned":true},"empty":"NO","key":"PRI","default":null,"extra":"","constraint":{"referenced_table":"exercise_descriptor","referenced_column":"id","update_rule":"CASCADE","delete_rule":"CASCADE"}},"locale":{"type":{"name":"varchar","size":"8"},"empty":"NO","key":"PRI","default":null,"extra":""},"name":{"type":{"name":"text"},"empty":"NO","key":"","default":null,"extra":""},"Meta":[{"type":"primary","columns":"fk_exercise_descriptor_id,locale"},{"type":"index","columns":"fk_exercise_descriptor_id"}]},"exercise_level":{"id":{"type":{"name":"int","size":"10","unsigned":true},"empty":"NO","key":"PRI","default":null,"extra":"auto_increment"},"fk_exercise_id":{"type":{"name":"int","size":"10","unsigned":true},"empty":"NO","key":"MUL","default":null,"extra":"","constraint":{"referenced_table":"exercise","referenced_column":"id","update_rule":"CASCADE","delete_rule":"CASCADE"}},"fk_user_id":{"type":{"name":"int","size":"10","unsigned":true},"empty":"NO","key":"MUL","default":null,"extra":"","constraint":{"referenced_table":"user","referenced_column":"ID","update_rule":"RESTRICT","delete_rule":"RESTRICT"}},"suggested_level":{"type":{"name":"int","size":"10","unsigned":true},"empty":"NO","key":"","default":null,"extra":""},"suggest_date":{"type":{"name":"datetime"},"empty":"NO","key":"","default":null,"extra":""},"Meta":[{"type":"primary","columns":"id"},{"type":"index","columns":"fk_exercise_id"},{"type":"index","columns":"fk_user_id"}]},"exercise_report":{"id":{"type":{"name":"int","size":"10","unsigned":true},"empty":"NO","key":"PRI","default":null,"extra":"auto_increment"},"fk_exercise_id":{"type":{"name":"int","size":"10","unsigned":true},"empty":"NO","key":"MUL","default":null,"extra":"","constraint":{"referenced_table":"exercise","referenced_column":"id","update_rule":"NO ACTION","delete_rule":"NO ACTION"}},"fk_user_id":{"type":{"name":"int","size":"10","unsigned":true},"empty":"NO","key":"MUL","default":null,"extra":"","constraint":{"referenced_table":"user","referenced_column":"ID","update_rule":"NO ACTION","delete_rule":"NO ACTION"}},"reason":{"type":{"name":"varchar","size":"100"},"empty":"NO","key":"","default":null,"extra":""},"report_date":{"type":{"name":"timestamp"},"empty":"NO","key":"","default":"CURRENT_TIMESTAMP","extra":""},"Meta":[{"type":"primary","columns":"id"},{"type":"index","columns":"fk_exercise_id"},{"type":"index","columns":"fk_user_id"}]},"exercise_role":{"id":{"type":{"name":"int","size":"10","unsigned":true},"empty":"NO","key":"PRI","default":null,"extra":"auto_increment"},"fk_exercise_id":{"type":{"name":"int","size":"10","unsigned":true},"empty":"NO","key":"MUL","default":null,"extra":"","constraint":{"referenced_table":"exercise","referenced_column":"id","update_rule":"CASCADE","delete_rule":"CASCADE"}},"fk_user_id":{"type":{"name":"int","size":"10","unsigned":true},"empty":"YES","key":"MUL","default":null,"extra":"","constraint":{"referenced_table":"user","referenced_column":"id","update_rule":"SET NULL","delete_rule":"SET NULL"}},"character_name":{"type":{"name":"varchar","size":"45"},"empty":"NO","key":"","default":null,"extra":""},"Meta":[{"type":"primary","columns":"id"},{"type":"index","columns":"fk_exercise_id"},{"type":"index","columns":"fk_user_id"}]},"exercise_score":{"id":{"type":{"name":"int","size":"10","unsigned":true},"empty":"NO","key":"PRI","default":null,"extra":"auto_increment"},"fk_exercise_id":{"type":{"name":"int","size":"10","unsigned":true},"empty":"NO","key":"MUL","default":null,"extra":"","constraint":{"referenced_table":"exercise","referenced_column":"id","update_rule":"CASCADE","delete_rule":"CASCADE"}},"fk_user_id":{"type":{"name":"int","size":"10","unsigned":true},"empty":"NO","key":"MUL","default":null,"extra":"","constraint":{"referenced_table":"user","referenced_column":"ID","update_rule":"RESTRICT","delete_rule":"RESTRICT"}},"suggested_score":{"type":{"name":"int","size":"10","unsigned":true},"empty":"NO","key":"","default":null,"extra":""},"suggestion_date":{"type":{"name":"datetime"},"empty":"NO","key":"","default":null,"extra":""},"Meta":[{"type":"primary","columns":"id"},{"type":"index","columns":"fk_exercise_id"},{"type":"index","columns":"fk_user_id"}]},"moodle_api":{"id":{"type":{"name":"varchar","size":"45"},"empty":"NO","key":"","default":null,"extra":""},"access_key":{"type":{"name":"varchar","size":"20"},"empty":"NO","key":"","default":null,"extra":""},"secret_access_key":{"type":{"name":"varchar","size":"40"},"empty":"NO","key":"","default":null,"extra":""},"projectname":{"type":{"name":"varchar","size":"45"},"empty":"NO","key":"","default":"","extra":""},"allowed_referer":{"type":{"name":"varchar","size":"100"},"empty":"NO","key":"","default":null,"extra":""},"date_created":{"type":{"name":"timestamp"},"empty":"NO","key":"","default":"CURRENT_TIMESTAMP","extra":""},"raw_referer":{"type":{"name":"varchar","size":"100"},"empty":"NO","key":"","default":"","extra":""},"Meta":[]},"motd":{"id":{"type":{"name":"int","size":"10","unsigned":true},"empty":"NO","key":"PRI","default":null,"extra":"auto_increment"},"title":{"type":{"name":"varchar","size":"250"},"empty":"NO","key":"","default":null,"extra":""},"message":{"type":{"name":"text"},"empty":"NO","key":"","default":null,"extra":""},"resource":{"type":{"name":"varchar","size":"250"},"empty":"NO","key":"","default":null,"extra":""},"displaydate":{"type":{"name":"datetime"},"empty":"NO","key":"","default":null,"extra":""},"displaywhenloggedin":{"type":{"name":"tinyint","size":"1"},"empty":"NO","key":"","default":"0","extra":""},"code":{"type":{"name":"varchar","size":"45"},"empty":"YES","key":"","default":null,"extra":""},"language":{"type":{"name":"varchar","size":"5"},"empty":"NO","key":"","default":null,"extra":""},"Meta":[{"type":"primary","columns":"id"}]},"preferences":{"id":{"type":{"name":"int","size":"10","unsigned":true},"empty":"NO","key":"PRI","default":null,"extra":"auto_increment"},"prefName":{"type":{"name":"varchar","size":"45"},"empty":"NO","key":"UNI","default":null,"extra":""},"prefValue":{"type":{"name":"varchar","size":"200"},"empty":"NO","key":"","default":null,"extra":""},"Meta":[{"type":"primary","columns":"id"},{"type":"index","columns":"prefName"}]},"rel_course_role_user":{"id":{"type":{"name":"int","size":"10","unsigned":true},"empty":"NO","key":"PRI","default":null,"extra":"auto_increment"},"fk_role_id":{"type":{"name":"int","size":"10","unsigned":true},"empty":"NO","key":"MUL","default":null,"extra":"","constraint":{"referenced_table":"role","referenced_column":"id","update_rule":"CASCADE","delete_rule":"CASCADE"}},"fk_course_id":{"type":{"name":"int","size":"10","unsigned":true},"empty":"NO","key":"MUL","default":null,"extra":"","constraint":{"referenced_table":"course","referenced_column":"id","update_rule":"CASCADE","delete_rule":"CASCADE"}},"fk_user_id":{"type":{"name":"int","size":"10","unsigned":true},"empty":"NO","key":"MUL","default":null,"extra":"","constraint":{"referenced_table":"user","referenced_column":"id","update_rule":"CASCADE","delete_rule":"CASCADE"}},"timemodified":{"type":{"name":"bigint","size":"10"},"empty":"NO","key":"","default":"0","extra":""},"Meta":[{"type":"primary","columns":"id"},{"type":"index","columns":"fk_course_id"},{"type":"index","columns":"fk_role_id"},{"type":"index","columns":"fk_user_id"}]},"rel_coursegroup_user":{"id":{"type":{"name":"int","size":"10","unsigned":true},"empty":"NO","key":"PRI","default":null,"extra":""},"fk_group_id":{"type":{"name":"int","size":"10","unsigned":true},"empty":"NO","key":"MUL","default":null,"extra":"","constraint":{"referenced_table":"course_groups","referenced_column":"id","update_rule":"NO ACTION","delete_rule":"NO ACTION"}},"fk_user_id":{"type":{"name":"int","size":"10","unsigned":true},"empty":"NO","key":"MUL","default":null,"extra":"","constraint":{"referenced_table":"user","referenced_column":"id","update_rule":"NO ACTION","delete_rule":"NO ACTION"}},"timeadded":{"type":{"name":"bigint","size":"10"},"empty":"NO","key":"","default":"0","extra":""},"Meta":[{"type":"primary","columns":"id"},{"type":"index","columns":"fk_group_id"},{"type":"index","columns":"fk_user_id"}]},"rel_exercise_descriptor":{"fk_exercise_id":{"type":{"name":"int","size":"10","unsigned":true},"empty":"NO","key":"PRI","default":null,"extra":"","constraint":{"referenced_table":"exercise","referenced_column":"id","update_rule":"CASCADE","delete_rule":"CASCADE"}},"fk_exercise_descriptor_id":{"type":{"name":"int","size":"10","unsigned":true},"empty":"NO","key":"PRI","default":null,"extra":"","constraint":{"referenced_table":"exercise_descriptor","referenced_column":"id","update_rule":"CASCADE","delete_rule":"CASCADE"}},"Meta":[{"type":"primary","columns":"fk_exercise_id,fk_exercise_descriptor_id"},{"type":"index","columns":"fk_exercise_id"},{"type":"index","columns":"fk_exercise_descriptor_id"}]},"rel_exercise_tag":{"fk_exercise_id":{"type":{"name":"int","size":"10","unsigned":true},"empty":"NO","key":"PRI","default":null,"extra":"","constraint":{"referenced_table":"exercise","referenced_column":"id","update_rule":"CASCADE","delete_rule":"CASCADE"}},"fk_tag_id":{"type":{"name":"int","size":"10","unsigned":true},"empty":"NO","key":"PRI","default":null,"extra":"","constraint":{"referenced_table":"tag","referenced_column":"id","update_rule":"CASCADE","delete_rule":"CASCADE"}},"Meta":[{"type":"primary","columns":"fk_exercise_id,fk_tag_id"},{"type":"index","columns":"fk_exercise_id"},{"type":"index","columns":"fk_tag_id"}]},"response":{"id":{"type":{"name":"int","size":"10","unsigned":true},"empty":"NO","key":"PRI","default":null,"extra":"auto_increment"},"fk_user_id":{"type":{"name":"int","size":"10","unsigned":true},"empty":"NO","key":"MUL","default":null,"extra":""},"fk_exercise_id":{"type":{"name":"int","size":"10","unsigned":true},"empty":"NO","key":"MUL","default":null,"extra":"","constraint":{"referenced_table":"exercise","referenced_column":"id","update_rule":"CASCADE","delete_rule":"CASCADE"}},"file_identifier":{"type":{"name":"varchar","size":"100"},"empty":"NO","key":"","default":null,"extra":""},"is_private":{"type":{"name":"tinyint","size":"1"},"empty":"NO","key":"","default":null,"extra":""},"thumbnail_uri":{"type":{"name":"varchar","size":"200"},"empty":"NO","key":"","default":"nothumb.png","extra":""},"source":{"type":{"name":"enum"},"empty":"NO","key":"","default":null,"extra":""},"duration":{"type":{"name":"int","size":"10","unsigned":true},"empty":"NO","key":"","default":null,"extra":""},"adding_date":{"type":{"name":"datetime"},"empty":"NO","key":"","default":null,"extra":""},"rating_amount":{"type":{"name":"int","size":"10"},"empty":"NO","key":"","default":null,"extra":""},"character_name":{"type":{"name":"varchar","size":"45"},"empty":"NO","key":"","default":null,"extra":""},"fk_transcription_id":{"type":{"name":"int","size":"10","unsigned":true},"empty":"YES","key":"MUL","default":null,"extra":"","constraint":{"referenced_table":"transcription","referenced_column":"id","update_rule":"RESTRICT","delete_rule":"SET NULL"}},"fk_subtitle_id":{"type":{"name":"int","size":"10","unsigned":true},"empty":"YES","key":"MUL","default":null,"extra":"","constraint":{"referenced_table":"subtitle","referenced_column":"id","update_rule":"CASCADE","delete_rule":"CASCADE"}},"priority_date":{"type":{"name":"timestamp"},"empty":"NO","key":"","default":"CURRENT_TIMESTAMP","extra":""},"Meta":[{"type":"primary","columns":"id"},{"type":"index","columns":"fk_user_id"},{"type":"index","columns":"fk_exercise_id"},{"type":"index","columns":"fk_transcription_id"},{"type":"index","columns":"fk_subtitle_id"}]},"role":{"id":{"type":{"name":"int","size":"11","unsigned":true},"empty":"NO","key":"PRI","default":null,"extra":"auto_increment"},"name":{"type":{"name":"varchar","size":"255"},"empty":"YES","key":"","default":"","extra":""},"shortname":{"type":{"name":"varchar","size":"255"},"empty":"NO","key":"","default":null,"extra":""},"description":{"type":{"name":"varchar","size":"45"},"empty":"YES","key":"","default":"","extra":""},"sortorder":{"type":{"name":"int","size":"11"},"empty":"NO","key":"","default":null,"extra":""},"archetype":{"type":{"name":"varchar","size":"255"},"empty":"NO","key":"","default":"","extra":""},"Meta":[{"type":"primary","columns":"id"}]},"serviceconsumer":{"id":{"type":{"name":"int","size":"10","unsigned":true},"empty":"NO","key":"PRI","default":null,"extra":"auto_increment"},"access_key":{"type":{"name":"varchar","size":"20"},"empty":"NO","key":"UNI","default":null,"extra":""},"secret_access_key":{"type":{"name":"varchar","size":"40"},"empty":"NO","key":"","default":null,"extra":""},"name":{"type":{"name":"varchar","size":"255"},"empty":"NO","key":"","default":null,"extra":""},"domain":{"type":{"name":"varchar","size":"255"},"empty":"NO","key":"","default":null,"extra":""},"ipaddress":{"type":{"name":"varchar","size":"45"},"empty":"NO","key":"","default":"","extra":""},"timecreated":{"type":{"name":"bigint","size":"10","unsigned":true},"empty":"NO","key":"","default":"0","extra":""},"timemodified":{"type":{"name":"bigint","size":"10","unsigned":true},"empty":"NO","key":"","default":"0","extra":""},"requestlimit":{"type":{"name":"int","size":"10","unsigned":true},"empty":"NO","key":"","default":"100","extra":""},"enabled":{"type":{"name":"tinyint","size":"1"},"empty":"NO","key":"","default":"1","extra":""},"salt":{"type":{"name":"varchar","size":"45"},"empty":"NO","key":"","default":null,"extra":""},"Meta":[{"type":"primary","columns":"id"},{"type":"index","columns":"access_key"}]},"serviceconsumer_log":{"id":{"type":{"name":"int","size":"11"},"empty":"NO","key":"PRI","default":null,"extra":""},"fk_serviceconsumer_id":{"type":{"name":"int","size":"10","unsigned":true},"empty":"NO","key":"MUL","default":null,"extra":"","constraint":{"referenced_table":"serviceconsumer","referenced_column":"id","update_rule":"NO ACTION","delete_rule":"NO ACTION"}},"time":{"type":{"name":"bigint","size":"10","unsigned":true},"empty":"NO","key":"","default":"0","extra":""},"method":{"type":{"name":"varchar","size":"45"},"empty":"NO","key":"","default":"","extra":""},"statuscode":{"type":{"name":"int","size":"11"},"empty":"NO","key":"","default":"500","extra":""},"ip":{"type":{"name":"varchar","size":"45"},"empty":"NO","key":"","default":"","extra":""},"referer":{"type":{"name":"varchar","size":"255"},"empty":"NO","key":"","default":"","extra":""},"origin":{"type":{"name":"varchar","size":"255"},"empty":"NO","key":"","default":"","extra":""},"consumertime":{"type":{"name":"bigint","size":"10"},"empty":"NO","key":"","default":"0","extra":""},"Meta":[{"type":"primary","columns":"id"},{"type":"index","columns":"fk_serviceconsumer_id"}]},"spinvox_request":{"id":{"type":{"name":"int","size":"11","unsigned":true},"empty":"NO","key":"PRI","default":null,"extra":"auto_increment"},"x_error":{"type":{"name":"varchar","size":"45"},"empty":"NO","key":"","default":null,"extra":""},"url":{"type":{"name":"varchar","size":"200"},"empty":"YES","key":"","default":null,"extra":""},"date":{"type":{"name":"datetime"},"empty":"NO","key":"","default":null,"extra":""},"fk_transcription_id":{"type":{"name":"int","size":"10","unsigned":true},"empty":"NO","key":"MUL","default":null,"extra":"","constraint":{"referenced_table":"transcription","referenced_column":"id","update_rule":"NO ACTION","delete_rule":"NO ACTION"}},"Meta":[{"type":"primary","columns":"id"},{"type":"index","columns":"fk_transcription_id"}]},"subtitle":{"id":{"type":{"name":"int","size":"10","unsigned":true},"empty":"NO","key":"PRI","default":null,"extra":"auto_increment"},"fk_exercise_id":{"type":{"name":"int","size":"10","unsigned":true},"empty":"NO","key":"MUL","default":null,"extra":"","constraint":{"referenced_table":"exercise","referenced_column":"id","update_rule":"CASCADE","delete_rule":"CASCADE"}},"fk_user_id":{"type":{"name":"int","size":"10","unsigned":true},"empty":"YES","key":"MUL","default":null,"extra":"","constraint":{"referenced_table":"user","referenced_column":"id","update_rule":"SET NULL","delete_rule":"SET NULL"}},"language":{"type":{"name":"varchar","size":"45"},"empty":"NO","key":"","default":null,"extra":""},"translation":{"type":{"name":"tinyint","size":"1"},"empty":"NO","key":"","default":"0","extra":""},"adding_date":{"type":{"name":"timestamp"},"empty":"NO","key":"","default":"CURRENT_TIMESTAMP","extra":"on update CURRENT_TIMESTAMP"},"complete":{"type":{"name":"tinyint","size":"1","unsigned":true},"empty":"NO","key":"","default":"0","extra":""},"Meta":[{"type":"primary","columns":"id"},{"type":"index","columns":"fk_exercise_id"},{"type":"index","columns":"fk_user_id"}]},"subtitle_line":{"id":{"type":{"name":"int","size":"10","unsigned":true},"empty":"NO","key":"PRI","default":null,"extra":"auto_increment"},"fk_subtitle_id":{"type":{"name":"int","size":"10","unsigned":true},"empty":"NO","key":"MUL","default":null,"extra":"","constraint":{"referenced_table":"subtitle","referenced_column":"id","update_rule":"CASCADE","delete_rule":"CASCADE"}},"show_time":{"type":{"name":"float","size":"","unsigned":true},"empty":"NO","key":"","default":null,"extra":""},"hide_time":{"type":{"name":"float","size":"","unsigned":true},"empty":"NO","key":"","default":null,"extra":""},"text":{"type":{"name":"varchar","size":"255"},"empty":"NO","key":"","default":null,"extra":""},"fk_exercise_role_id":{"type":{"name":"int","size":"10","unsigned":true},"empty":"NO","key":"MUL","default":null,"extra":"","constraint":{"referenced_table":"exercise_role","referenced_column":"id","update_rule":"CASCADE","delete_rule":"CASCADE"}},"Meta":[{"type":"primary","columns":"id"},{"type":"index","columns":"fk_subtitle_id"},{"type":"index","columns":"fk_exercise_role_id"}]},"subtitle_score":{"id":{"type":{"name":"int","size":"10","unsigned":true},"empty":"NO","key":"PRI","default":null,"extra":"auto_increment"},"fk_subtitle_id":{"type":{"name":"int","size":"10","unsigned":true},"empty":"NO","key":"MUL","default":null,"extra":"","constraint":{"referenced_table":"subtitle","referenced_column":"id","update_rule":"NO ACTION","delete_rule":"NO ACTION"}},"fk_user_id":{"type":{"name":"int","size":"10","unsigned":true},"empty":"NO","key":"MUL","default":null,"extra":"","constraint":{"referenced_table":"user","referenced_column":"ID","update_rule":"NO ACTION","delete_rule":"NO ACTION"}},"suggested_score":{"type":{"name":"int","size":"10","unsigned":true},"empty":"NO","key":"","default":null,"extra":""},"suggestion_date":{"type":{"name":"datetime"},"empty":"NO","key":"","default":null,"extra":""},"Meta":[{"type":"primary","columns":"id"},{"type":"index","columns":"fk_subtitle_id"},{"type":"index","columns":"fk_user_id"}]},"tag":{"id":{"type":{"name":"int","size":"10","unsigned":true},"empty":"NO","key":"PRI","default":null,"extra":"auto_increment"},"name":{"type":{"name":"varchar","size":"45"},"empty":"NO","key":"","default":null,"extra":""},"Meta":[{"type":"primary","columns":"id"}]},"transcription":{"id":{"type":{"name":"int","size":"10","unsigned":true},"empty":"NO","key":"PRI","default":null,"extra":"auto_increment"},"adding_date":{"type":{"name":"datetime"},"empty":"NO","key":"","default":null,"extra":""},"status":{"type":{"name":"varchar","size":"45"},"empty":"NO","key":"","default":null,"extra":""},"transcription":{"type":{"name":"text"},"empty":"YES","key":"","default":null,"extra":""},"transcription_date":{"type":{"name":"datetime"},"empty":"YES","key":"","default":null,"extra":""},"system":{"type":{"name":"varchar","size":"45"},"empty":"NO","key":"","default":null,"extra":""},"Meta":[{"type":"primary","columns":"id"}]},"user":{"id":{"type":{"name":"int","size":"10","unsigned":true},"empty":"NO","key":"PRI","default":null,"extra":"auto_increment"},"username":{"type":{"name":"varchar","size":"45"},"empty":"NO","key":"MUL","default":null,"extra":""},"fk_serviceconsumer_id":{"type":{"name":"int","size":"10","unsigned":true},"empty":"NO","key":"MUL","default":null,"extra":"","constraint":{"referenced_table":"serviceconsumer","referenced_column":"id","update_rule":"NO ACTION","delete_rule":"NO ACTION"}},"password":{"type":{"name":"varchar","size":"45"},"empty":"NO","key":"","default":null,"extra":""},"email":{"type":{"name":"varchar","size":"45"},"empty":"NO","key":"","default":null,"extra":""},"firstname":{"type":{"name":"varchar","size":"45"},"empty":"NO","key":"","default":null,"extra":""},"lastname":{"type":{"name":"varchar","size":"45"},"empty":"NO","key":"","default":null,"extra":""},"creditCount":{"type":{"name":"int","size":"10","unsigned":true},"empty":"NO","key":"","default":"0","extra":""},"joiningDate":{"type":{"name":"timestamp"},"empty":"NO","key":"","default":"CURRENT_TIMESTAMP","extra":""},"active":{"type":{"name":"tinyint","size":"1"},"empty":"NO","key":"","default":"0","extra":""},"activation_hash":{"type":{"name":"varchar","size":"20"},"empty":"NO","key":"","default":null,"extra":""},"isAdmin":{"type":{"name":"tinyint","size":"4"},"empty":"NO","key":"","default":"0","extra":""},"Meta":[{"type":"primary","columns":"id"},{"type":"index","columns":"username,fk_serviceconsumer_id"},{"type":"index","columns":"fk_serviceconsumer_id"}]},"user_languages":{"id":{"type":{"name":"int","size":"10","unsigned":true},"empty":"NO","key":"PRI","default":null,"extra":"auto_increment"},"fk_user_id":{"type":{"name":"int","size":"10","unsigned":true},"empty":"NO","key":"MUL","default":null,"extra":"","constraint":{"referenced_table":"user","referenced_column":"ID","update_rule":"CASCADE","delete_rule":"CASCADE"}},"language":{"type":{"name":"varchar","size":"45"},"empty":"NO","key":"","default":null,"extra":""},"level":{"type":{"name":"int","size":"10","unsigned":true},"empty":"NO","key":"","default":null,"extra":""},"positives_to_next_level":{"type":{"name":"int","size":"10","unsigned":true},"empty":"NO","key":"","default":null,"extra":""},"purpose":{"type":{"name":"enum"},"empty":"NO","key":"","default":"practice","extra":""},"Meta":[{"type":"primary","columns":"id"},{"type":"index","columns":"fk_user_id"}]},"user_session":{"id":{"type":{"name":"int","size":"10","unsigned":true},"empty":"NO","key":"PRI","default":null,"extra":"auto_increment"},"session_id":{"type":{"name":"varchar","size":"100"},"empty":"NO","key":"","default":null,"extra":""},"session_date":{"type":{"name":"datetime"},"empty":"NO","key":"","default":null,"extra":""},"duration":{"type":{"name":"int","size":"10"},"empty":"NO","key":"","default":null,"extra":""},"keep_alive":{"type":{"name":"tinyint","size":"1"},"empty":"NO","key":"","default":null,"extra":""},"fk_user_id":{"type":{"name":"int","size":"10","unsigned":true},"empty":"NO","key":"MUL","default":null,"extra":"","constraint":{"referenced_table":"user","referenced_column":"ID","update_rule":"CASCADE","delete_rule":"CASCADE"}},"closed":{"type":{"name":"tinyint","size":"1"},"empty":"NO","key":"","default":"0","extra":""},"Meta":[{"type":"primary","columns":"id"},{"type":"index","columns":"fk_user_id"}]},"user_videohistory":{"id":{"type":{"name":"int","size":"10","unsigned":true},"empty":"NO","key":"PRI","default":null,"extra":"auto_increment"},"fk_user_id":{"type":{"name":"int","size":"10","unsigned":true},"empty":"NO","key":"MUL","default":null,"extra":"","constraint":{"referenced_table":"user","referenced_column":"ID","update_rule":"CASCADE","delete_rule":"CASCADE"}},"fk_user_session_id":{"type":{"name":"int","size":"10","unsigned":true},"empty":"NO","key":"MUL","default":null,"extra":"","constraint":{"referenced_table":"user_session","referenced_column":"id","update_rule":"CASCADE","delete_rule":"CASCADE"}},"fk_exercise_id":{"type":{"name":"int","size":"10","unsigned":true},"empty":"NO","key":"MUL","default":null,"extra":"","constraint":{"referenced_table":"exercise","referenced_column":"id","update_rule":"CASCADE","delete_rule":"CASCADE"}},"response_attempt":{"type":{"name":"tinyint","size":"1"},"empty":"NO","key":"","default":"0","extra":""},"fk_response_id":{"type":{"name":"int","size":"10","unsigned":true},"empty":"YES","key":"MUL","default":null,"extra":"","constraint":{"referenced_table":"response","referenced_column":"id","update_rule":"CASCADE","delete_rule":"CASCADE"}},"incidence_date":{"type":{"name":"timestamp"},"empty":"NO","key":"","default":"CURRENT_TIMESTAMP","extra":""},"subtitles_are_used":{"type":{"name":"tinyint","size":"1"},"empty":"NO","key":"","default":"0","extra":""},"fk_subtitle_id":{"type":{"name":"int","size":"10","unsigned":true},"empty":"YES","key":"MUL","default":null,"extra":"","constraint":{"referenced_table":"subtitle","referenced_column":"id","update_rule":"CASCADE","delete_rule":"CASCADE"}},"fk_exercise_role_id":{"type":{"name":"int","size":"10","unsigned":true},"empty":"YES","key":"MUL","default":null,"extra":"","constraint":{"referenced_table":"exercise_role","referenced_column":"id","update_rule":"CASCADE","delete_rule":"CASCADE"}},"Meta":[{"type":"primary","columns":"id"},{"type":"index","columns":"fk_user_id"},{"type":"index","columns":"fk_user_session_id"},{"type":"index","columns":"fk_exercise_id"},{"type":"index","columns":"fk_response_id"},{"type":"index","columns":"fk_subtitle_id"},{"type":"index","columns":"fk_exercise_role_id"}]}}';
	
