<?xml version="1.0" encoding="utf-8"?>
<mx:Application xmlns:mx="http://www.adobe.com/2006/mxml"
				layout="vertical"
				backgroundGradientAlphas="[1.0, 1.0]"
				backgroundGradientColors="[#E5E8EA, #FFFFFF]"
				verticalAlign="top"
				horizontalAlign="center"
				borderSides="0"
				paddingTop="5"
				paddingBottom="5"
				xmlns:control="control.*"
				xmlns:business="business.*"
				xmlns:ns1="modules.main.*"
				xmlns:ns2="modules.userManagement.*"
				preinitialize="init();"
				height="100%"
				width="100%"
				pageTitle="Babelia: Collaborative Language e-Learning"
				historyManagementEnabled="false"
				creationComplete="onComplete()">

	<mx:Script>
		<![CDATA[
			import control.*;
			
			import events.PreferenceEvent;
			import events.UserEvent;
			
			import model.DataModel;
			
			private var mainSO:SharedObject;
			
			[Bindable]
			public var appModelLocator: DataModel;
			[Bindable]
			public var cuePointManager: CuePointManager;
			[Bindable]
			public var browserManager:BabeliaBrowserManager;

			//Initialization method
			private function init():void
			{
				appModelLocator = DataModel.getInstance();
				cuePointManager = CuePointManager.getInstance();
				
				new PreferenceEvent(PreferenceEvent.GET_APP_PREFERENCES).dispatch();
				new UserEvent(UserEvent.GET_TOP_TEN_CREDITED).dispatch();
				
				Security.allowDomain(appModelLocator.uploadDomain);
			}
			
			private function onComplete(e:Event = null) : void
			{
				browserManager = BabeliaBrowserManager.getInstance();
			}
			
			private function set onExercisesRetrieved(value:Object) : void
			{
				browserManager.parseURL();
			}
		]]>
	</mx:Script>

	<mx:Binding source="{DataModel.getInstance().availableExercises}"
				destination="this.onExercisesRetrieved"/>
	
	<!--Instantiate controller and services singleton -->

	<!--This defines the reachable remote services -->
	<business:Services />

	<!--This defines all the actions available -->
	<control:Controller/>

	<ns1:Header id="header"
				width="100%">
	</ns1:Header>
	<ns1:Navigation id="navigation"
					width="100%">
	</ns1:Navigation>
	<ns1:Body id="content"
			  height="100%"
			  width="100%">
	</ns1:Body>

</mx:Application>