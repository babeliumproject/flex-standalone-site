<?xml version="1.0" encoding="utf-8"?>
<mx:Canvas xmlns:mx="http://www.adobe.com/2006/mxml"
		   creationComplete="init()"
		   backgroundColor="#678594">
	<mx:Metadata>
        [ResourceBundle("myResources")]
    </mx:Metadata>
	<mx:Script>
		<![CDATA[
			import events.ExerciseEvent;
			
			import model.DataModel;
			
			import mx.collections.ArrayCollection;
			
			import vo.ExerciseVO;


			[Bindable]
			private var dp:ArrayCollection;
			
			public var thumbURL:String = '';

			public function init():void
			{
				thumbURL = DataModel.getInstance().thumbURL;
				new ExerciseEvent(ExerciseEvent.GET_EXERCISES).dispatch();
			}
			
			public function set handleExercisesRetrieve(value:Boolean):void{
				if(DataModel.getInstance().availableExercisesRetrieved.getItemAt(1)){
					dp=DataModel.getInstance().availableExercises;
					DataModel.getInstance().availableExercisesRetrieved.setItemAt(false,1);
				}
			}

			private function changeHandler(event:Event):void
			{
				var obj:ExerciseVO = DataGrid(event.target).selectedItem as ExerciseVO;
				new ExerciseEvent(ExerciseEvent.EXERCISE_SELECTED, obj).dispatch();
			}
			
			public function thumbSet(data:Object):String{
				return (thumbURL+"/"+data.thumbnailUri);
			}
		]]>
	</mx:Script>
	
	<mx:Binding source="{DataModel.getInstance().availableExercisesRetrieved.getItemAt(1)}" 
				destination="handleExercisesRetrieve" />

	<mx:HBox width="100%" horizontalAlign="center">
		<mx:DataGrid verticalAlign="middle"
					 width="100%"
					 height="450"
					 id="exer0ciseListDatagrid"
					 dataProvider="{dp}"
					 change="changeHandler(event)"
					 doubleClickEnabled="true" 
					 fontFamily="Arial"
					 fontSize="15"
					 fontWeight="bold"
					 textAlign="center"
					 verticalScrollPolicy="auto"
					 sortableColumns="false"
					 draggableColumns="false"
					 useHandCursor="true"
					 color="#3C390B">
			<mx:columns>
				<mx:DataGridColumn headerText="{resourceManager.getString('myResources', 'IRUDIA')}"
								   dataField="thumbnail_uri"
								   width="100">
					<mx:itemRenderer>
						<mx:Component>
							<mx:VBox horizontalAlign="center"
									 verticalAlign="middle">
								<mx:Image id="albumImage"
										  height="90"
										  width="90"
										  source="{parentDocument.thumbSet(data)}"/>
							</mx:VBox>
						</mx:Component>
					</mx:itemRenderer>
				</mx:DataGridColumn>
				<mx:DataGridColumn width="200" headerText="{resourceManager.getString('myResources', 'NOMBRE')}"
								   dataField="title">
					<mx:itemRenderer>
						<mx:Component>
							<mx:Text text="{data.title}" selectable="false"/>
						</mx:Component>
					</mx:itemRenderer>
				</mx:DataGridColumn>
				<mx:DataGridColumn headerText="{resourceManager.getString('myResources', 'DURACION')}"
								   dataField="duration">
					<mx:itemRenderer>
						<mx:Component>
							<mx:Label text="{data.duration + ' ' + resourceManager.getString('myResources', 'MESSAGE_SECONDS')}"/>
						</mx:Component>
					</mx:itemRenderer>
				</mx:DataGridColumn>
				<mx:DataGridColumn headerText="{resourceManager.getString('myResources', 'AUTOR')}"
								   dataField="userName"/>
			</mx:columns>
		</mx:DataGrid>
	</mx:HBox>

</mx:Canvas>