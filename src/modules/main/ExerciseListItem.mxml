<?xml version="1.0" encoding="utf-8"?>
<mx:HBox xmlns:mx="http://www.adobe.com/2006/mxml"

		 paddingTop="8"
		 paddingBottom="8"
		 paddingLeft="8"
		 paddingRight="8"
		 verticalAlign="middle"
		 xmlns:ns1="com.asfusion.controls.*"
		 fontFamily="Arial"
		 creationComplete="init()">

	<mx:Image id="thumbnail"
			  scaleContent="true"
			  source="resources/images/thumbs/nothumb.png"
			  autoLoad="true"
			  click="imageClickHandler(event)"
			  width="120"
			  height="90"
			  toolTip="{data.title}"
			  useHandCursor="true" buttonMode="true"
			  />
	<mx:VBox height="90"
			 width="100%"
			 verticalGap="2">
		<mx:HBox horizontalAlign="left"
				 verticalAlign="middle"
				 horizontalGap="2"
				 width="100%">
			<mx:Image width="16"
					  height="16"
					  toolTip="{exerciseLanguage.source}"
					  id="exerciseLanguage"/>
			<mx:LinkButton label="{data.title}"
						   fontSize="12"
						   width="100%"
						   textAlign="left"
						   click="titleClickHandler(event)"/>
		</mx:HBox>

		<mx:HRule height="1"
				  width="100%"/>
		<mx:Text text="{data.description}"
				 width="100%"
				 fontSize="12"/>
		<mx:HBox verticalAlign="middle">
			<ns1:Rating value="{data.avgRating}" liveRollOver="false"/>
			<mx:Label text="{data.addingDate}"
					  fontWeight="bold"/>
			<mx:LinkButton label="{data.userName}"/>
		</mx:HBox>

	</mx:VBox>


	<mx:Script>
		<![CDATA[
			import events.ExerciseEvent;
			import events.ExerciseRoleEvent;
			import events.SubtitleEvent;
			
			import model.DataModel;
			
			import vo.ExerciseRoleVO;
			import vo.ExerciseVO;
			import vo.SubtitleAndSubtitleLinesVO;
			private var _data:Object;
			
			public function init():void
			{
				_data = data;
				var temp:ExerciseVO = _data as ExerciseVO;
				if (temp.language == "Basque")
					exerciseLanguage.source = "resources/images/flags/flag_basque_country.png";
				else if (temp.language == "Spanish")
					exerciseLanguage.source = "resources/images/flags/flag_spain.png";
				else if (temp.language == "English")
					exerciseLanguage.source = "resources/images/flags/flag_united_kingdom.png";
				else if (temp.language == "France")
					exerciseLanguage.source = "resources/images/flags/flag_france.png";
				thumbnail.source = getImageSource();
			}

			private function imageClickHandler(event:MouseEvent):void
			{		
				viewExercise();
			}

			private function titleClickHandler(event:MouseEvent):void
			{
				viewExercise();
			}
			
			public function getImageSource():String{
				var url:String = '';
				if (_data.source == "Red5")
					url = DataModel.getInstance().thumbURL + "/" + _data.thumbnailUri;
				else
					url = _data.thumbnailUri;
				return url;
			}

			private function viewExercise():void
			{		
				DataModel.getInstance().videoPlayerControlsViewStack=1;
				var temp:Object = data;
				var tempEx:ExerciseVO = temp as ExerciseVO;
				var subtitles:SubtitleAndSubtitleLinesVO = new SubtitleAndSubtitleLinesVO(0,tempEx.id,0,tempEx.language);
				var roles:ExerciseRoleVO = new ExerciseRoleVO();
				roles.exerciseId = tempEx.id;

				//If it doesn't work this way, we can chain the events
				new ExerciseRoleEvent(ExerciseRoleEvent.GET_EXERCISE_ROLES, roles).dispatch();
				new SubtitleEvent(SubtitleEvent.GET_EXERCISE_SUBTITLE_LINES, subtitles).dispatch();
				new ExerciseEvent(ExerciseEvent.WATCH_EXERCISE,tempEx).dispatch();
			}

			private function trimTitle():void
			{

			}

			private function trimDescription():void
			{

			}
		]]>
	</mx:Script>

</mx:HBox>
